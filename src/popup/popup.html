<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Nexus Accessibility Testing Toolkit</title>
    <link rel="stylesheet" href="popup.css" />
    <link rel="stylesheet" href="modal.css" />
    <link
      rel="stylesheet"
      href="components/segmented-control/segmented-control.css"
    />
  </head>
  <body>
    <div class="popup">
      <header class="header-container">
        <div class="logo-container">
          <img src="../assets/nexus-logo.svg" alt="Nexus" class="nexus-logo" />
        </div>
        <div class="segmented-control-container">
          <div class="segmented-control-legend">Inspector</div>
          <div class="segmented-control" id="nexus-inspector-control">
            <input
              type="radio"
              id="inspector-off"
              name="inspector"
              value="off"
              checked
            />
            <label for="inspector-off">Off</label>
            <input type="radio" id="inspector-on" name="inspector" value="on" />
            <label for="inspector-on">On</label>
            <input
              type="radio"
              id="inspector-mini"
              name="inspector"
              value="mini"
            />
            <label for="inspector-mini"
              >Mini<span class="sr-only"> Mode</span></label
            >
          </div>
        </div>
      </header>
      <main class="main-content">
      <div role="tablist" aria-label="Nexus Popup Tabs" class="tabs">
        <button
          role="tab"
          aria-selected="true"
          aria-controls="tabpanel-main"
          id="tab-main"
          class="tab"
        >
          Main
        </button>
        <button
          role="tab"
          aria-selected="false"
          aria-controls="tabpanel-reports"
          id="tab-reports"
          tabindex="-1"
          class="tab"
        >
          Reports
        </button>
        <button
          role="tab"
          aria-selected="false"
          aria-controls="tabpanel-settings"
          id="tab-settings"
          tabindex="-1"
          class="tab"
        >
          Settings
        </button>
        <button
          role="tab"
          aria-selected="false"
          aria-controls="tabpanel-shortcuts"
          id="tab-shortcuts"
          tabindex="-1"
          class="tab"
        >
          Shortcuts
        </button>
      </div>
      <!-- Main Tab -->
      <div
        id="tabpanel-main"
        role="tabpanel"
        aria-labelledby="tab-main"
        class="tabpanel"
      >
        <div class="info-container">
          <div class="page-info">
            <dl>
              <dt>Title</dt>
              <dd id="page-title">Loading…</dd>
              <dt>Language</dt>
              <dd id="page-lang">Loading…</dd>
            </dl>
          </div>
        </div>
        <div
          id="accessibility-alerts-section"
          class="info-container"
          style="margin-top: 16px; position: relative"
        >
          <h2>Accessibility Alerts</h2>
          <div id="alerts-summary-wrapper" class="alerts-summary-wrapper">
            <!-- Call-to-action message above alerts -->
            <div class="alerts-cta-message">
              <p>Enable Inspector to Scan for Accessibility Alerts</p>
            </div>

            <!-- Single alerts section - will show default content or real scan results -->
            <div
              id="alerts-summary-content"
              class="alerts-summary-content"
              style="display: block"
            >
              <div
                id="alerts-overview-summary"
                class="alerts-overview-summary"
              >
                <!-- Default content - will be replaced by real scan results when available -->
                <div class="overview-stats">
                  <div class="overview-stat" style="border-left-color: #dc2626">
                    <span class="overview-stat-count">3</span>
                    <span class="overview-stat-label">Critical</span>
                  </div>
                  <div class="overview-stat" style="border-left-color: #ea580c">
                    <span class="overview-stat-count">2</span>
                    <span class="overview-stat-label">Serious</span>
                  </div>
                  <div class="overview-stat" style="border-left-color: #d97706">
                    <span class="overview-stat-count">1</span>
                    <span class="overview-stat-label">Moderate</span>
                  </div>
                </div>
                <div
                  class="overview-meta"
                  style="margin-top: 8px; font-size: 12px; color: #64748b"
                >
                  <strong>6</strong> violation rules, <strong>12</strong> passes
                </div>
              </div>
            </div>

            <!-- Blur overlay for when no cached scan is available -->
            <div id="alerts-blur-overlay" style="display: none;">
              <div class="overlay-content">
                <p>Inspector is disabled</p>
              </div>
            </div>

            <!-- Legacy loading/error states (hidden by default) -->
            <div
              id="alerts-summary-loading"
              class="loading-state"
              style="display: none"
            >
              <div class="spinner"></div>
              <span>Scanning page...</span>
            </div>
            <div
              id="alerts-summary-content"
              class="alerts-summary-content"
              style="display: none"
            >
              <div
                id="alerts-overview-summary"
                class="alerts-overview-summary"
              ></div>
            </div>
            <div
              id="alerts-summary-error"
              class="error-state"
              style="display: none"
            >
              <span>Unable to scan page</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Reports Tab -->
      <div
        id="tabpanel-reports"
        role="tabpanel"
        aria-labelledby="tab-reports"
        tabindex="0"
        class="tabpanel"
        hidden
      >
        <div class="info-container">
          <h2>Reports</h2>
          <!-- Create Report button moved above the table -->
          <div class="report-create-section" style="margin-bottom: 16px;">
            <div class="report-button-group" style="display: flex">
              <button
                id="primary-report-btn"
                class="primary-button report-main-btn component-create-report"
                data-origin="reports-tab"
                style="flex: 2 1 66%"
              >
                <span
                  class="button-icon"
                  data-icon="plus"
                  aria-hidden="true"
                ></span
                ><span class="btn-label">Create Report</span>
              </button>
              <button
                id="report-dropdown-btn"
                class="primary-button report-dropdown-btn"
                aria-label="Report options"
                aria-expanded="false"
                aria-haspopup="menu"
                style="flex: 1 1 34%"
              >
                <span class="dropdown-icon">▼</span>
              </button>
              <div
                id="report-dropdown"
                class="dropdown-menu"
                role="menu"
                hidden
              >
                <ul role="none">
                  <li>
                    <button
                      id="append-report-option"
                      class="dropdown-item"
                      role="menuitem"
                    >
                      Append to Report
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            <div
              id="new-report-status"
              class="status-message"
              style="display: none"
            ></div>
          </div>
          <!-- Reports table will be loaded here dynamically -->
          <div id="reports-table-container" class="reports-table-container">
            <div class="loading-state">
              <div class="spinner"></div>
              <span>Loading reports...</span>
            </div>
          </div>
        </div>
      </div>
      <!-- Settings Tab -->
      <div
        id="tabpanel-settings"
        role="tabpanel"
        aria-labelledby="tab-settings"
        tabindex="0"
        class="tabpanel"
        hidden
      >
        <div class="info-container">
          <h2>Settings</h2>
          <div class="data-actions">
            <h3>Export & Import</h3>
            <div class="button-group">
              <button id="export-data-btn" class="secondary-button">
                Export Data
              </button>
              <button id="import-data-btn" class="secondary-button">
                Import Data
              </button>
              <input
                type="file"
                id="import-file-input"
                accept=".json"
                style="display: none"
              />
            </div>
            <div
              id="import-options"
              class="import-options"
              style="display: none"
            >
              <h4>Import Conflict Resolution</h4>
              <div class="radio-group">
                <label
                  ><input
                    type="radio"
                    name="conflict-strategy"
                    value="timestamp"
                    checked
                  /><span>Keep newer reports (timestamp)</span></label
                >
                <label
                  ><input
                    type="radio"
                    name="conflict-strategy"
                    value="device"
                  /><span>Keep all reports (device-specific)</span></label
                >
                <label
                  ><input
                    type="radio"
                    name="conflict-strategy"
                    value="skip"
                  /><span>Skip conflicting reports</span></label
                >
              </div>
              <div class="button-group">
                <button id="confirm-import-btn" class="primary-button">
                  Confirm Import
                </button>
                <button id="cancel-import-btn" class="secondary-button">
                  Cancel
                </button>
              </div>
            </div>
            <div
              id="import-results"
              class="import-results"
              style="display: none"
            >
              <h4>Import Results</h4>
              <div id="import-summary"></div>
              <button id="close-results-btn" class="secondary-button">
                Close
              </button>
            </div>
            <div class="data-danger-zone">
              <h3>Danger Zone</h3>
              <button id="clear-all-data-btn" class="danger-button">
                Clear All Data
              </button>
              <div
                id="clear-confirmation"
                class="confirmation-dialog"
                style="display: none"
              >
                <p>
                  This will permanently delete all stored accessibility reports.
                  This action cannot be undone.
                </p>
                <div class="button-group">
                  <button id="confirm-clear-btn" class="danger-button">
                    Yes, Delete All Data
                  </button>
                  <button id="cancel-clear-btn" class="secondary-button">
                    Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Shortcuts Tab -->
      <div
        id="tabpanel-shortcuts"
        role="tabpanel"
        aria-labelledby="tab-shortcuts"
        tabindex="0"
        class="tabpanel"
        hidden
      >
        <div class="info-container">
          <h2>Keyboard Shortcuts</h2>
          <div
            id="shortcuts-container"
            class="shortcuts-container"
            aria-live="polite"
          ></div>
        </div>
      </div>
    </div>
  </main>
    <script src="../utils/impact-icons.js" defer></script>
    <script src="../utils/accessibility-database.js" defer></script>
    <script src="icons.js" defer></script>
    <script src="shortcuts.js" defer></script>
    <script src="modal.js" defer></script>
    <script src="modules/ui-manager.js" defer></script>
    <script src="modules/scan-manager.js" defer></script>
    <script src="modules/tab-manager.js" defer></script>
    <script src="modules/icon-utils.js" defer></script>
    <script src="modules/create-report-button.js" defer></script>
    <script src="modules/split-button-menu.js" defer></script>
    <script src="modules/reports-manager.js" defer></script>
    <script src="popup-main.js" defer></script>
  </body>
</html>
